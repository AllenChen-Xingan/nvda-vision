# NVDA Vision Screen Reader - 现实约束文档

## 文档说明

本文档定义了NVDA视觉屏幕阅读器项目必须遵守的现实约束（Reality Constraints）。这些约束关注AI可能忽略但在现实世界中会造成严重后果的事项，特别是隐私保护、安全合规、用户体验和系统稳定性。

---

<real>
- 屏幕截图数据必须优先本地处理，仅在本地模型失败时才调用云端API，并需明确告知用户
- 用户的API密钥必须加密存储在本地配置文件中，不得明文保存或上传到任何服务器
- 所有UI元素识别结果必须包含置信度评分，低于阈值的结果需标注"不确定"并提供手动触发重新识别选项
- NVDA插件必须符合WCAG 2.1 AA级无障碍标准，所有功能必须可通过键盘访问
- 插件崩溃或模型推理失败不得影响NVDA主程序运行，必须使用独立线程和完善的异常处理
- 模型推理时间超过5秒需显示进度提示，超过15秒自动降级到备用方案或提示用户取消
- 开源许可必须使用Apache 2.0或MIT，确保商业和非商业用户均可自由使用和修改
</real>

---

## 约束详解

### 1. 隐私优先：屏幕截图数据本地处理

**约束内容**: 屏幕截图数据必须优先本地处理，仅在本地模型失败时才调用云端API，并需明确告知用户

**理由**:
- 屏幕截图可能包含敏感信息（个人隐私、商业机密、账号密码等）
- 视障用户往往对隐私更加敏感，因为他们无法"看见"屏幕上有什么内容被上传
- 未经明确授权的数据上传可能违反GDPR、《个人信息保护法》等法规

**违规后果**:
- 用户隐私泄露，造成严重信任危机
- 可能面临法律诉讼和巨额罚款
- 项目声誉受损，无法在辅助技术社区立足

**实施要求**:
- 默认配置为"仅本地模式"
- 首次使用云端API时弹出明确提示框，说明哪些数据会被上传
- 配置文件中提供`enable_cloud_api: false`选项
- 日志记录所有云端API调用，便于用户审计

---

### 2. 安全存储：API密钥加密保护

**约束内容**: 用户的API密钥必须加密存储在本地配置文件中，不得明文保存或上传到任何服务器

**理由**:
- API密钥是用户的重要凭证，泄露后可能导致经济损失（云服务被滥用）
- 明文存储的密钥容易被恶意软件窃取
- 符合业界最佳安全实践（如OWASP安全指南）

**违规后果**:
- 用户API密钥泄露，导致云服务费用损失
- 黑客可能利用泄露的密钥进行攻击
- 项目安全性受到质疑，无法通过安全审计

**实施要求**:
- 使用Windows Data Protection API (DPAPI) 加密密钥
- 或使用基于用户密码的对称加密（如AES-256）
- 绝不将密钥写入日志文件或错误报告
- 提供密钥导入/导出功能时也必须加密

---

### 3. 透明度：识别结果置信度标注

**约束内容**: 所有UI元素识别结果必须包含置信度评分，低于阈值的结果需标注"不确定"并提供手动触发重新识别选项

**理由**:
- AI模型不是100%准确，误识别可能导致用户操作错误
- 视障用户无法通过视觉验证识别结果的正确性，完全依赖语音反馈
- 透明度是建立用户信任的关键，特别是在辅助技术领域

**违规后果**:
- 用户因误识别导致误操作（如点击错误按钮、发送错误信息）
- 用户对系统失去信任，放弃使用
- 可能造成工作事故或人身伤害（如医疗、金融等高风险场景）

**实施要求**:
- 所有识别结果包含`confidence`字段（0-1之间）
- 置信度 < 0.7 时朗读"不确定"前缀
- 提供快捷键（如NVDA+Shift+R）重新识别当前元素
- 配置文件允许用户自定义置信度阈值

---

### 4. 无障碍标准：WCAG 2.1 AA级合规

**约束内容**: NVDA插件必须符合WCAG 2.1 AA级无障碍标准，所有功能必须可通过键盘访问

**理由**:
- 这是为视障人士开发的工具，必须本身具备完美的无障碍性
- WCAG 2.1 AA是国际公认的无障碍标准，许多国家和地区强制要求
- "为盲人做的工具本身不无障碍"是极大的讽刺

**违规后果**:
- 工具本身无法被目标用户使用，项目失去意义
- 可能违反《无障碍环境建设法》等法规
- 社区批评和负面评价

**实施要求**:
- 所有功能提供键盘快捷键
- 所有UI元素（包括配置界面）有清晰的NVDA朗读标签
- 遵循NVDA插件开发最佳实践
- 通过NVDA自动化测试验证无障碍性

---

### 5. 系统稳定性：独立线程与异常隔离

**约束内容**: 插件崩溃或模型推理失败不得影响NVDA主程序运行，必须使用独立线程和完善的异常处理

**理由**:
- NVDA是视障人士的"眼睛"，崩溃意味着用户完全失去操作能力
- 模型推理是计算密集型任务，容易出现内存溢出、GPU错误等异常
- 作为第三方插件，不能因自身问题影响NVDA核心功能

**违规后果**:
- NVDA主程序崩溃，用户陷入"黑屏"状态，无法操作电脑
- 用户可能被迫强制重启电脑，导致未保存数据丢失
- 严重影响用户工作和生活，可能造成经济损失

**实施要求**:
- 所有耗时操作在独立线程（`threading.Thread`）中执行
- 使用`try-except`包裹所有模型调用和外部API请求
- 异常发生时记录日志，但继续提供降级服务（如提示用户手动操作）
- 设置超时机制，防止线程永久挂起

---

### 6. 用户体验：推理时间与进度反馈

**约束内容**: 模型推理时间超过5秒需显示进度提示，超过15秒自动降级到备用方案或提示用户取消

**理由**:
- 视障用户依赖听觉反馈，长时间无声会让他们不知道系统是否在工作
- GPU模型推理可能需要较长时间（特别是首次加载）
- 过长的等待时间严重影响用户体验和工作效率

**违规后果**:
- 用户以为系统卡死，频繁重启或放弃使用
- 工作效率低下，用户体验极差
- 负面口碑传播，影响项目推广

**实施要求**:
- 推理超过5秒时朗读"正在识别，请稍候..."
- 每3秒更新一次进度提示（如"识别中...已用时8秒"）
- 超过15秒时自动降级：
  - GPU模型 → CPU模型 → 云端API
  - 或提示用户"识别时间过长，是否继续？[Enter继续/Esc取消]"
- 配置文件允许用户自定义超时阈值

---

### 7. 开源合规：许可证选择

**约束内容**: 开源许可必须使用Apache 2.0或MIT，确保商业和非商业用户均可自由使用和修改

**理由**:
- 辅助技术应该惠及所有人，包括企业用户和个人开发者
- Apache 2.0和MIT是最宽松的开源许可，兼容性好
- 商业友好的许可有助于企业采纳，推动无障碍技术发展

**违规后果**:
- GPL等强传染性许可可能阻碍企业采纳（如飞书、钉钉集成我们的方案）
- 限制性许可违背项目"让更多人受益"的初衷
- 法律纠纷风险

**实施要求**:
- 项目根目录添加`LICENSE`文件（Apache 2.0或MIT）
- 所有源代码文件头部包含许可声明
- 依赖的第三方库也必须是兼容性许可（如BSD、MIT、Apache 2.0）
- 明确说明商业使用权限

---

## 技术环境约束

<environment>
<stack>
**操作系统**: Windows 10/11 (x64)

**Python环境**: Python 3.11（NVDA推荐版本）

**NVDA版本**: 2023.1 - 2024.4

**GPU要求（可选）**:
- NVIDIA GPU，CUDA 11.8+
- 显存 ≥ 16GB（UI-TARS 7B）或 ≥ 8GB（量化版本）

**CPU/内存要求（备用方案）**:
- CPU: x64架构，支持AVX2指令集
- 内存: ≥ 8GB（推荐16GB）
- 硬盘: ≥ 50GB可用空间（存储模型文件）

**网络要求（云端备份）**:
- 可访问火山引擎豆包API（中国大陆可访问）
- 最低带宽: 1Mbps（上传屏幕截图）
</stack>
</environment>

---

## 约束检查清单

在开发过程中，每个功能模块必须通过以下检查：

### 隐私与安全
- [ ] 屏幕数据默认本地处理，云端调用有明确提示
- [ ] API密钥加密存储，绝不明文保存
- [ ] 无用户授权不上传任何数据到外部服务器
- [ ] 日志文件不包含敏感信息（密钥、截图内容等）

### 用户体验
- [ ] 识别结果包含置信度评分
- [ ] 低置信度结果有"不确定"标注
- [ ] 超过5秒显示进度提示
- [ ] 超过15秒自动降级或允许用户取消
- [ ] 所有功能有键盘快捷键
- [ ] 所有UI元素有清晰的NVDA朗读标签

### 系统稳定性
- [ ] 耗时操作在独立线程执行
- [ ] 完善的异常处理（try-except）
- [ ] 插件崩溃不影响NVDA主程序
- [ ] 超时机制防止线程永久挂起

### 合规性
- [ ] 符合WCAG 2.1 AA级标准
- [ ] 开源许可为Apache 2.0或MIT
- [ ] 依赖库许可兼容
- [ ] 明确商业使用权限

---

## 版本信息

**文档版本**: 1.0.0
**创建日期**: 2025-12-24
**最后更新**: 2025-12-24
**依赖文档**: meta.md
**后续文档**: cog.md (认知模型)
